<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stripe Subscription Demo</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .form-group { margin-bottom: 10px; }
    #card-element { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    button { padding: 10px 20px; }
    #status { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Stripe Subscription Test</h1>

  <div class="form-group">
    <label>Email:</label>
    <input type="email" id="email" value="test@example.com" />
  </div>

  <div class="form-group">
    <label>Amount (USD cents):</label>
    <input type="number" id="amount" value="2000" />
  </div>

  <div class="form-group">
    <label>Interval:</label>
    <select id="interval">
      <option value="month">Monthly</option>
      <option value="year">Yearly</option>
    </select>
  </div>

  <div class="form-group">
    <label>Card details:</label>
    <div id="payment-element"></div>
  </div>

  <button id="subscribe-btn">Subscribe Now</button>
  <div id="status"></div>

    <script>
  const stripe = Stripe('pk_test_51RvWHkAECEHGAgkMffEDYFvQSAwvtz5tRGlcvp74Zu3lIqnZ7XPVBHXR9at8ZWLkpVGLZ9zKqtqPVenIiXzZFPzV00HfzCWbCE'); // your publishable key

  document.getElementById('subscribe-btn').addEventListener('click', async () => {
    const email = document.getElementById('email').value;

    const res = await fetch('http://localhost:3000/stripe/subscribe-user-flow', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId: 'user-123',                // Replace with your app's user ID
            email: 'test@example.com',
            productIdInDb: 'prod-db-001',      // Your internal DB product ID
            productName: 'Pro Plan',
            priceIdInDb: 'price-db-001',       // Your internal DB price ID
            amount: 2000,
            currency: 'usd',
            interval: 'month',
            subscriptionIdInDb: 'sub-db-001'
      }),
    });

    const data = await res.json();
    if (!data.url) {
      return alert('No client secret returned from server');
    }

    window.location.href = data.url;
    // **Init embedded checkout**
    // const { error } = await stripe.initEmbeddedCheckout({
    //   clientSecret: data.clientSecret
    // });

    if (error) {
      alert('Subscription failed: ' + error.message);
    } else {
      alert('âœ… Subscription created successfully!');
    }
  });
</script>

</body>
</html>
